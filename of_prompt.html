<!doctype html>
<html>
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  html,body{margin:0;padding:0;background:#ededed;color:#111;font:16px -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;}
  .wrap{display:flex;flex-direction:column;gap:10px;padding:12px 16px;height:100%;box-sizing:border-box;}
  .row{display:flex;align-items:center;}
  .label{font-size:12px;color:#5f6368;margin-bottom:4px;}
  .title{flex:1;border:none;outline:none;background:#fff;border-radius:8px;padding:10px 12px;font-size:20px;font-weight:600;box-shadow: inset 0 0 0 1px #d0d0d0;}
  .title::placeholder{color:#9aa0a6;font-weight:500;}
  .project{flex:1;border:none;outline:none;background:#fff;border-radius:8px;padding:9px 12px;font-size:14px;box-shadow: inset 0 0 0 1px #d0d0d0;}
  .body{flex:1;min-height:360px;border:none;outline:none;background:#fff;border-radius:8px;padding:10px 12px;font-size:14px;line-height:1.4;box-shadow: inset 0 0 0 1px #d0d0d0;resize:vertical;}
  .hint{font-size:11px;color:#80868b;}
</style>
</head>
<body>
  <div class="wrap">
    <div class="row" style="flex-direction:column;align-items:stretch;">
      <div class="label">Title</div>
      <input id="title" class="title" type="text" spellcheck="false" autocomplete="off" placeholder="Enter task title" value="{{TITLE}}"/>
    </div>
    <div class="row" style="flex-direction:column;align-items:stretch;flex:1;">
      <div class="label">Selection</div>
      <textarea id="body" class="body" spellcheck="false">{{BODY}}</textarea>
      <div class="hint">Enter to submit (when in Title). Cmd+Enter always submits. Esc cancels.</div>
    </div>
  </div>
  <script>
    const handler = window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.ofPrompt;
    function send(event, payload){ if(handler){ handler.postMessage(Object.assign({event}, payload||{})); } }
    const input = document.getElementById('title');
    const body = document.getElementById('body');
    setTimeout(()=>{ input.focus(); input.select(); }, 0);
    document.addEventListener('keydown', (e)=>{
      if((e.metaKey || e.ctrlKey) && e.key === 'Enter'){
        send('submit', { title: input.value, body: body.value });
      } else if(e.key === 'Enter' && document.activeElement === input){
        send('submit', { title: input.value, body: body.value });
      }
      if(e.key === 'Escape'){ send('cancel', {}); }
    });
  </script>
</body>
</html>
